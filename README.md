# Dian

a repo to store the code of Dian Group

该库内有两个文件夹，ESP32S3文件夹，为基于arduino框架的工程

IDF为基于IDF框架的工程

为了在规定时间内完成所有基础要求和扩展要求，所以采用了arduino框架加速开发，IDF框架内预计只会包含基础要求和一两项扩展

### ESP32S3

~~类似于stm32，对每个功能进行模块化封装~~ 

事实证明，arduino框架的封装，导致自己封装的模块会出现奇奇怪怪的问题，遂放弃，只在IDF框架采用

基础部分已完成:

- 点灯 3.12
- 串口 3.12
- I2C读取MPU6050数据 3.12
- 解算MPU6050速度 3.13
- 数据优化 3.15



扩展部分已完成：

- 数据传输到上位机，使用电脑进行数值计算 3.13
- WIFI传输数据（手机热点作为AP，ESP8266作为STA） 3.13
- WEB搭建，展示数据 3.14
- 屏幕显示 3.16
- 基于lvgl的UI制作 3.16



LEVEL 1 

- [x] 点灯

LEVEL 2

- [x] 串口
- [x] IIC

LEVEL 2 ==扩展==

- [x] 连接AP，获取IP
- [x] WiFi传输六轴数据到电脑
- [x] 搭建WEB，实现逻辑交互

LEVEL 3

- [x] 解算速度
- [x] 优化数据

LEVEL 3 ==扩展==

- [x] 计算欧拉角
- [x] 计算移动方向，移动速度
- [x] 计算移动轨迹

LEVEL 4 ==扩展==

- [x] 传输到电脑，电脑进行数值计算

LEVEL 5 ==扩展==

- [x] 屏幕显示
- [x] LVGL移植





### IDF

类似于stm32，对每个功能进行模块化封装

基础部分已完成：

- 点灯封装
- 串口封装 3.16
- i2c封装 3.17
- mpu6050姿态解算封装 3.17



------------

工程大体完成 3.17

*纪念 UI设计

![miku](https://cdn.jsdelivr.net/gh/SHR-sky/Picture@main/Pic/IMG_20240317_185848_edit_66651877896292.jpg)



--------------

学习记录

### 3.12

由于大一了解过arduino，所以查询esp32资料时，优先选择，进行快速开发。由于习惯使用VSCode，所以选择插件platformIO进行开发。利用函数，简单实现了点灯操作。由于之前学习过一定stm32，所以进行了函数再封装。然后，利用自带的串口函数，进行了串口收发信息。

由于学长建议采用官方插件配合IDF框架使用，所以接下来时间用于配置IDF环境，以及了解Cmake，同时了解到IDF组件功能，对GPIO操作成功后，对函数也进行了封装。

接下来，由于之前没有使用过esp32的iic，所以阅读了官方库<Wire.h>，然后查询手册后，发现ESP32S3没有标注硬件串口，所以我采取软件iic。同时，在配置通信频率时，出现了问题，经过仔细阅读Wire.begin的函数封装，发现使用软件iic时，必需要自定义频率，无默认值。在晚上1：00解决问题。



### 3.13

阅读MPU6050相关手册，大概了解到其中原理

![img](https://pic4.zhimg.com/80/v2-7fbb30722a0b63bbbfe46b760b3e0557_1440w.webp)

![image-20240319183120635](https://cdn.jsdelivr.net/gh/SHR-sky/Picture@main/Pic/image-20240319183120635.png)

然后在platformIO中下载MPU6050库，根据封装好的函数，读出了数据，并且通过串口传到了电脑上。

然后，在pip install python的Serial库，经过简单的代码编写，读出了串口的数据，保存在了csv数据集中，同时还进行了运算。

接下来，开始了解WiFi传输数据，我首先阅读了arduino框架自带的<WiFi.h>库函数，并且经过浏览器搜索，发现有 网络助手，下载后，成功连接手机热点并且发送数据。

并且在学长建议下，尝试了使用python，实现了接收数据功能。



### 3.14

由于只学过C，了解过python，对于js和go一窍不通。所以，联想到了当初美赛采用的echart，一番研究下，发现python也有echart的库，遂装好后开始研究。在网上找到了一个使用pythonechart的例子，结合我前一天的python实现的串口读取函数和WiFi函数，最后实现了网页显示。虽然，可以显示数据和进行开关灯的逻辑交互，但是任无法显示图表。

经过查询，发现js中存在内嵌网页的代码，但是经过长时间尝试后，发现无法嵌入本地路径的html文件，然后经过尝试后任然未解决。最终，尝试了一下，直接嵌入网页，竟然成功了。所以，最后采用本地服务器上，借助vscode server插件，开启图表网页，然后，然后在显示数据的网页上嵌入本地服务器网页的方法实现了图表的显示。

由于毫无网络方面基础，这一天，基本全部在搭建WEB。



### 3.15

对代码进行优化，顺便采集了很多静止时的数据，求平均，算偏置



### 3.16

然后在IDF框架上，查询手册，确定了MPU6050地址，实现了读取数据。同时，在使用IDF框架过程中，遇到很多编译失败问题，涉及到CmakeList的依赖，以及封装组件后，main函数的Cmake编写。在研究CmakeList过程中，中文互联网无法查到解决问题的资料，最后英文搜索，在GitHub中找到解决方法。



### 3.17

由于无成品触摸屏卖，故买了块电阻屏和SPI转接板，手动焊接屏幕排线。

然后，安装lvgl库，借助squareline进行ui设计和移植，由于无中文教程，故通过学习官网资料和官方例程成功运行ui。

最终成功显示数据，但是由于时间不足，所以只能简单设计ui。

并且完善IDF的i2c库。



### 3.18

整理代码，采用条件编译来优化代码结果，同时分开main函数，新建了几个工程，便于面试时展示。



### 3.19

阅读、移植IDF的WiFi例程，并且继续完善IDF框架的组件，完善了一下pyhton代码，继续采集数据算偏置，提高精度，最后撰写README文档，记录学习历程。

这几天收获颇丰。